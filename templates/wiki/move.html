{% extends "wiki/article.html" %}
{% load wiki_tags i18n sekizai_tags %}
{% block wiki_pagetitle %}
    {% trans "Move" %}: {{ article.current_revision.title }}
{% endblock %}
{% block wiki_contents_tab %}
    <div class="columns">
        <div class="column is-four-fifths">
            <form method="POST" id="article_move_form">
                {% wiki_form form %}
                <div class="dropdown" id="dest_selector">
                    <div class="dropdown-trigger">
                        <button class="button is-rounded"
                                type="button"
                                aria-haspopup="true"
                                aria-controls="dropdown-menu-dest">
                            <span class="dest_selector_title"></span>
                            <span class="icon is-small">
                                <i class="fa fa-angle-down" aria-hidden="true"></i>
                            </span>
                        </button>
                    </div>
                    <div class="dropdown-menu" id="dropdown-menu-dest" role="menu">
                        <div class="dropdown-content">
                            {% with current_path=root_path %}
                                {% include "wiki/includes/move_tree.html" %}
                            {% endwith %}
                        </div>
                    </div>
                </div>
                <div class="content">
                    <p>
                        {% blocktrans count cnt=urlpath.get_descendants.count trimmed %}
                            {{ cnt }} nested article will also be moved.
                            <br>
                            Be careful, links to this article and {{ cnt }} article nested
                            in this hierarchy will not be updated.
                        {% plural %}
                            {{ cnt }} nested articles will also be moved.
                            <br>
                            Be careful, links to this article and {{ cnt }} articles nested
                            in this hierarchy will not be updated.
                        {% endblocktrans %}
                    </p>
                </div>
                <div class="field is-grouped">
                    <div class="control">
                        <a href="{% url 'wiki:get' path=urlpath.path article_id=article.id %}"
                           class="button is-rounded">
                            <span class="icon">
                                <i class="fa fa-arrow-left"></i>
                            </span>
                            <span>{% trans "Go back" %}</span>
                        </a>
                    </div>
                    <div class="control">
                        <button class="button is-rounded is-link"
                                type="submit"
                                name="move"
                                id="id_move">
                            <span class="icon">
                                <i class="fa fa-random"></i>
                            </span>
                            <span>{% trans "Move article" %}</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    {% addtoblock "css" %}
    <style>
    #dest_selector .dropdown-content {
        background-color: white;
        opacity: 1;
    }
    #dest_selector .dropdown-item {
        background-color: white;
    }
    #dest_selector .dropdown-item:hover {
        background-color: #f5f5f5;
    }

    @media (prefers-color-scheme: dark) {
        #dest_selector .dropdown-content {
            background-color: #363636;
            color: #f5f5f5;
        }
        #dest_selector .dropdown-item {
            background-color: #363636;
            color: #f5f5f5;
        }
        #dest_selector .dropdown-item:hover {
            background-color: #4a4a4a;
        }
    }
    </style>
{% endaddtoblock %}
{% addtoblock "js" %}
<script type="text/javascript">
    $('#id_destination').after($('#dest_selector').remove());
    $('#id_destination').attr('type', 'hidden');
    $('#id_slug').val('{{ urlpath.slug }}');
    select_path('{{urlpath.parent.pk}}', '{{urlpath.parent}}');

    function select_path(path, title) {
      $('#id_destination').val(path);
      if (title == "(root)") title = "";
      $('#dest_selector .dest_selector_title').html(title ? title : "&nbsp;&nbsp;/&nbsp;&nbsp;");
    }

    // Toggle dropdown on button click
    $('#dest_selector .dropdown-trigger button').on('click', function(e) {
      e.preventDefault();
      $('#dest_selector').toggleClass('is-active');
    });

    // Close dropdown when clicking outside
    $(document).on('click', function(e) {
      if (!$(e.target).closest('#dest_selector').length) {
        $('#dest_selector').removeClass('is-active');
      }
    });

    // Close dropdown when an item is selected
    $('#dest_selector .dropdown-content').on('click', 'a', function() {
      $('#dest_selector').removeClass('is-active');
    });
</script>
{% endaddtoblock %}
{% endblock %}
