{% extends "wiki/article.html" %}
{% load wiki_tags i18n humanize wiki_thumbnails %}


{% block wiki_pagetitle %}{% trans "Images" %}: {{ article.current_revision.title }}{% endblock %}

{% block wiki_contents_tab %}
  <div class="content">
    <p>{% trans "The following images are available for this article. Copy the markdown tag to directly refer to an image from the article text." %}</p>
    <p>
      <a href="{% url 'wiki:edit' path=urlpath.path article_id=article.id %}" class="button is-small">
        <span class="icon">
          <i class="fa fa-arrow-left"></i>
        </span>
        <span>{% trans "Back to edit page" %}</span>
      </a>
    </p>
  </div>

  {% for image in images %}
    {% with image.current_revision.imagerevision as revision %}
    <div class="box">
      <div class="columns">
        <div class="column is-one-third">
          <figure class="image">
            {% thumbnail revision.image "250x250" as thumb %}
              <img src="{{ thumb.url }}" alt="{{ revision.get_filename }}" />
            {% endthumbnail %}
          </figure>
          {% if image|can_write:user %}
          <div class="buttons are-small mt-3">
            {% if revision.deleted %}
              <a href="{% url 'wiki:images_add_revision' path=urlpath.path article_id=article.id image_id=image.id %}" class="button is-small">
                <span class="icon"><i class="fa fa-upload"></i></span>
                <span>{% trans "Upload and publish new image" %}</span>
              </a>
              <a href="{% url 'wiki:images_restore' path=urlpath.path article_id=article.id image_id=image.id %}" class="button is-small">
                <span class="icon"><i class="fa fa-refresh"></i></span>
                <span>{% trans "Restore image" %}</span>
              </a>
            {% else %}
              <a href="{% url 'wiki:images_add_revision' path=urlpath.path article_id=article.id image_id=image.id %}" class="button is-small">
                <span class="icon"><i class="fa fa-upload"></i></span>
                <span>{% trans "Upload replacement" %}</span>
              </a>
              <a href="{% url 'wiki:images_delete' path=urlpath.path article_id=article.id image_id=image.id %}" class="button is-small is-danger">
                <span class="icon"><i class="fa fa-remove"></i></span>
                <span>{% trans "Remove image" %}</span>
              </a>
            {% endif %}
            {% if article|can_moderate:user %}
              <a href="{% url 'wiki:images_purge' path=urlpath.path article_id=article.id image_id=image.id %}" class="button is-small is-danger">
                <span class="icon"><i class="fa fa-trash"></i></span>
                <span>{% trans "Completely delete" %}</span>
              </a>
            {% endif %}
          </div>
          {% endif %}
        </div>
        <div class="column is-two-thirds">
          <table class="table is-fullwidth">
            <thead>
              <tr>
                <th>{{ revision.get_filename|default:_("No file") }}</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <strong>{% trans "Markdown tag" %}:</strong> <code>[image:{{ image.id }}]</code>
                </td>
              </tr>
              <tr>
                <td>
                  <strong>{% trans "Uploaded by" %}:</strong>
                  {% include "wiki/includes/revision_info.html" %}
                </td>
              </tr>
              <tr>
                <td>
                  <strong>{% trans "Size" %}:</strong> {{ revision.get_size|filesizeformat }} ({{ revision.width }}x{{ revision.height }} pixels)
                </td>
              </tr>
            </tbody>
          </table>

          <h4 class="title is-5">{% trans "History" %}</h4>
          <table class="table is-narrow is-fullwidth">
            {% for old_revision in image.revision_set.all %}
              <tr>
                <td style="width: 60px;">
                  {% thumbnail old_revision.imagerevision.image "50x50" crop="center" as thumb %}
                    <img src="{{ thumb.url }}" alt="{{ revision.imagerevision.get_filename }}" />
                  {% endthumbnail %}
                </td>
                <td>{% include "wiki/includes/revision_info.html" with current_revision=image.current_revision revision=old_revision %}</td>
                <td>{{ old_revision.imagerevision.get_size|filesizeformat }}</td>
                <td>{{ old_revision.imagerevision.width }}x{{ old_revision.imagerevision.height }}</td>
                <td>
                  {% if image|can_write:user and old_revision != image.current_revision %}
                    <a href="{% url 'wiki:images_set_revision' path=urlpath.path article_id=article.id image_id=image.id rev_id=old_revision.id %}" class="button is-small">
                      <span class="icon"><i class="fa fa-refresh"></i></span>
                      <span>{% trans "Revert to this version" %}</span>
                    </a>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </table>
        </div>
      </div>
    </div>
    {% endwith %}
  {% empty %}
    <div class="content">
      <p><em>{% trans "There are no images for this article." %}</em></p>
    </div>
  {% endfor %}

  {% include "wiki/includes/pagination.html" %}

{% endblock %}
