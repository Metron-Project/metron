{% extends parent_template|default:"base.html" %}
{% load static %}
{% load bulma_tags %}
{% block title %}
    {{ title|default:"Form" }}
{% endblock title %}
{% block headcss %}{{ form.media.css }}{% endblock %}
{% block content %}
    <header class="block has-text-centered">
        <h1 class="title">{{ title|default:"Form" }}</h1>
    </header>
    <form method="post" enctype="multipart/form-data" id="mainForm" novalidate>
        {% csrf_token %}
        <!-- Primary Information Section -->
        <div class="box">
            <h2 class="title is-5">Primary Information</h2>
            {% include "comicsdb/partials/form_errors.html" with form=form %}
            {% for field in form.hidden_fields %}{{ field }}{% endfor %}
            {% for field in form.visible_fields %}
                {% include "comicsdb/partials/form_field.html" with field=field %}
            {% endfor %}
        </div>
        <!-- Attribution Section -->
        <div class="box">
            <h2 class="title is-5">Attribution</h2>
            {% include "comicsdb/partials/attribution_formset.html" with formset=attribution %}
        </div>
        <!-- Submit Button -->
        <div class="field">
            <div class="control">
                <button class="button is-rounded is-info" type="submit">
                    <span class="icon">
                        <i class="fas fa-check"></i>
                    </span>
                    <span>Submit</span>
                </button>
            </div>
        </div>
    </form>
{% endblock %}
{% block js %}
    <script src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
    {{ form.media.js }}
    <script src="{% static 'site/js/jquery.formset.js' %}"></script>
    <script src="{% static 'site/js/bulma-fileupload.js' %}"></script>
    <script src="{% static 'site/js/bulma-calendar.min.js' %}"></script>
    <script>
$(function() {
    'use strict';

    // Initialize bulma-calendar for date inputs
    var dateInputs = document.querySelectorAll('input[data-bulma-calendar="on"]');
    dateInputs.forEach(function(input) {
        bulmaCalendar.attach(input, {
            type: 'date',
            dateFormat: 'yyyy-MM-dd',
            displayMode: 'default',
            showHeader: true,
            closeOnSelect: true,
            clearButton: false,
            todayButton: true,
            showFooter: true,
            weekStart: 0
        });
    });

    // Initialize attribution formset
    $('#mainForm #attributionTable tbody tr').formset({
        prefix: '{{ attribution.prefix }}',
        deleteText: 'Remove?',
        addText: 'Add another attribution',
        added: function($row) {
            console.log('Attribution row added');
        },
        removed: function($row) {
            console.log('Attribution row removed');
        }
    });
});
    </script>
{% endblock %}
